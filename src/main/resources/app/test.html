<html><head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"  charset="UTF-8">

${include /app/head.incl}        
        
        <link rel="stylesheet" type="text/css" href="/app/styles/special.css" media="screen">
        <script type="text/javascript" src="/app/scripts/um.js"></script>
        <script type="text/javascript" src="/app/scripts/df.js"></script>

        <style>
            * {
                font-family: Monospace;
            }
            table {
                border-collapse:collapse;
            }
            td.icon {
                padding: 0px;
                width: 1%;
            }
            img.icon {
                min-width: 50px;
                max-width: 75px;
                width: 10vw;
            }
            
            @media screen and (max-width: 1000px) {
            }
            
            @media screen and (max-width: 500px) {
            }
            
            @media screen and (max-width: 300px) {
            }
        </style>

        
<link rel="stylesheet" type="text/css" href="/app/styles/calendar.css" media="screen">
<script type="text/javascript" src="/app/scripts/calendar.js"></script>
        
        <script type="text/javascript" src="/app/scripts/eventsHandler.js"></script>
        <script type="text/javascript" src="/app/scripts/eventPlannersHandler.js"></script>
        
        <script type="text/javascript">

function evalCascaded(el,name) {
    var offset=el[name];
    return el[name]+((el.parentElement) ? evalCascaded(el.parentElement,name) : 0);
}
            
var events=eventsHandler('evs');
var eventPlanners=eventPlannersHandler('eps').configure(null,function(dh){
    dh.filterRenderer.configure({
        viewElementId: 'h_filter',    
        viewSwithWidth: 700,
        columnSize: 10,
        onStart: function(dfs,params) {
            
            return "";
        },
        isVisible: function(item) {
            var visible=true;
            var el=(item && item.id) ? document.getElementById('filter_'+item.id) : null;
            if(el && el.style.display!='none') {
            } else if(el){
                visible=false;
            }else {
                visible=false;
            }
            return visible;
        },
        toNumeric: function (val) {
            if("number"==typeof(val)) return val;
            val=""+val;
            if(val.endsWith("px")) val=val.substring(0,val.length-2);
            return new Number(val);
        },
        toggleVisibility: function(item) {
            var elementName="filter_"+item.id;
            var el=document.getElementById(elementName);
            var elMain=document.getElementById("main_"+elementName);
            var elMin=document.getElementById("min_"+elementName);
            if(el) {
                if(el.style.display!='none') {
                    el.style.display='none';
                    if(elMin) elMin.style.display='';
                } else {
                    el.style.zIndex=1000;
                    if(document.documentElement.clientWidth>this.viewSwithWidth) {
                        // no corrections if within table cells...
                        el.style.display=null;
                    } else {
                        var top=evalCascaded(elMain,"offsetTop");
                        var left=evalCascaded(elMain,"offsetLeft");
                        var height=elMain.offsetHeight;//this.toNumeric(window.getComputedStyle(elMain, null).getPropertyValue('height'));
                        var elW=el.offsetWidth;
                        if(left+elW>document.documentElement.clientWidth) {
                            left=document.documentElement.clientWidth-elW-2;
                        }
                        el.style.left=(left-2)+"px";
                        el.style.top=(top+height+2)+"px";
                        el.style.display=null;
                        var elW=el.offsetWidth;
                        if(left+elW>document.documentElement.clientWidth) {
                            left=document.documentElement.clientWidth-elW-2;
                            el.style.left=(left-2)+"px";
                        }
                    }
                    if(elMin) elMin.style.display='none';
                }
            }
        },
        doStarter: function(items) {
            {   // switch filter view area from "h_" to "v_" or vice versa...
                if(document.documentElement.clientWidth>this.viewSwithWidth) {
                    this.viewElementId = this.viewElementId.replace("h_","v_");
                } else {
                    this.viewElementId = this.viewElementId.replace("v_","h_");
                    if(this.columnSize!=-1) {
                        this.columnSize=Math.ceil(document.documentElement.clientWidth/100);
                    }
                }
            }
            //return "<table border='0' width='100%'><tr><td valign='top'>";
            return "<table class='filter_cell'><tr class='filter_cell'><td class='filter_cell'>";
        },
        doColumn: function(index,item,params) {
            return "";//"</td></tr><tr class='filter_cell'><td class='filter_cell'>";
        },
        doDelimiter: function(index,item,params) {
            return (document.documentElement.clientWidth>this.viewSwithWidth) 
            ? "</td></tr><tr class='filter_cell'><td class='filter_cell'>"
            : "";
        },
        doEnder: function(items) {
            return "</td></tr></table>";
        },
        doItem: function(idx,df,params) {
            var s="";
            if(df) {
                var cl="filter";
                var a=false;
                var si="";
                var sx="";
                var hasSI=false;

                // build self/no self selector
                si="<span class='filter_sel' id='min_filter_"+df.id+"'>";
                s+="<span class='filter_main' id='main_filter_"+df.id+"'><span class='filter' onclick='var dh=getDataHandler(\""+df.dhId+"\"); dh.filterRenderer.toggleVisibility(dh.dataFilters[\""+df.id+"\"]);'>"+df.title;
                s+="</span>";
                sx+="<div class='filter_exp' id='filter_"+df.id+"'>";
                sx+="<table class='filter'>";

                if(df.valueOf(null)) {
                    a=df.isActive(null);
                    sx+="<tr class='filter'><td class='"+cl+(a ? "_active": "")+"'";
                    sx+=" onclick='var dh=getDataHandler(\""+df.dhId+"\"); dh.dataFilters[\""+df.id+"\"].onActivate(null)"+"; dh.filterRenderer.toggleVisibility(dh.dataFilters[\""+df.id+"\"]); dh.renderFilter(); dh.loadData(); '";
                    if(df.columns) sx+=" colspan='"+df.columns+"'";
                    sx+=">";
                    sx+=df.valueOf(null);
                    sx+="</td></tr>";
                    if(a) {
                        si+=df.valueOf(null)+" ";
                        hasSI=true;
                    }
                }

                if(df.columns)
                    sx+="<tr class='filter'>";

                var ac=0;
                for(var k in df.keys()) {
                    if(!df.isValueKey(k)) continue;
                    a=df.isActive(k);

                    if(df.columns) {
                        var n=new Number(k);
                        if(n>0 && (n % df.columns) == 0){
                            sx+="</tr><tr class='filter'>";
                        }
                    } else {
                        sx+="<tr class='filter'>";
                    }

                    sx+="<td class='"+cl+((a) ? "_active": "")+"'";
                    sx+=" onclick='var dh=getDataHandler(\""+df.dhId+"\"); dh.dataFilters[\""+df.id+"\"].onActivate(\""+k+"\")"+"; dh.filterRenderer.toggleVisibility(dh.dataFilters[\""+df.id+"\"]); dh.renderFilter(); dh.loadData(); '>";
                    sx+=df.valueOf(k);
                    if(df.columns)
                        sx+="</td>";
                    else
                        sx+="</td></tr>";
                    if(a) {
                        if(ac>0) si+=' ';
                        si+=df.valueOf(k);
                        hasSI=true;
                        ac++;
                    }
                }
                if(df.columns) sx+="</tr>";

                sx+="</table>";
                sx+="</div>";
                si+="</span>";
                s+=sx;
                if(hasSI) {
                    if(document.documentElement.clientWidth>this.viewSwithWidth) s+='<br/>&nbsp;';
                    //else s+='<br/>';
                    s+=si;
                }
                s+="</span>\n";
            }
            return s;
        }
    });
});
var handler=events;
var minScale=0.7;
var maxScale=1.4;



function toolbarToSchedule(){ clearViewAreas(); handler=events; handler.loadMeta();}
function toolbarToPlanner(){clearViewAreas(); handler=eventPlanners; handler.loadMeta();}
function toolbarToContactsMap(){clearViewAreas();}
function toolbarToContacts(){clearViewAreas();}
function clearViewAreas() {
    var elIds=['v_filter','h_filter','data_view','data_view2'];
    for(var i in elIds) {
        var elId=elIds[i];
        var el=document.getElementById(elId);
        if(el) el.innerHTML="";
    }
}


////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////// redraw on resize/orientation
////////////////////////////////////////////////////////////////////////////////
function updateOrientation() {
    var viewport = document.querySelector("meta[name=viewport]");
    viewport.setAttribute('content', 'width=' + window.screen.width + ', initial-scale=1.0, minimum-scale='+minScale+', maximum-scale='+maxScale);
}
window.addEventListener('resize', function(event) { updateOrientation(); handler.renderFilter();}, false);
window.addEventListener('orientationchange', updateOrientation(), false);



////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////// initialize on load
////////////////////////////////////////////////////////////////////////////////
document.addEventListener('DOMContentLoaded', function() {
    if(isValidUser()) {
       var el=document.getElementById('userInfo');
       var un=userDisplayName();
       var ud=userDomainName();
       el.innerHTML=""
         +"<a onclick='showUserForm();'>"
         +un
         +"</a>"
         +"&nbsp;("
         +"<a onclick='showUserChangePwdForm();'>"
         +ud
         +"</a>"
         +")&nbsp;"
         +"<a onclick='doLogout();' class='login' ttar='#{Logout}'><img src='images/icons8-logout-90.png' alt='#{Logout}...' width='20'><tt>#{Logout}</tt></a>";
    } else {
       var el=document.getElementById('userInfo');
       el.innerHTML="<a onclick='showLoginForm();' class='login' ttar='#{Login}'><img src='images/icons8-login-90.png' alt='#{Login}...' width='20'><tt>#{Login}</tt></a>";
       REST_api.loginVariants(
         function(url,data) { 
           if(data.result) {
              var loginLinks=data.result;
              showLoginLinks(loginLinks);
           } 
         }
       );
    }
    if(userLocale) {
       var locs=["en","ru","fi"];
       for(var loci in locs) {
          var loc=locs[loci];
          if(loc) {
             var locEl=document.getElementById('locale_'+loc);
             if(locEl) {
               if(userLocale==loc) locEl.style.display='none';
             }
          }
       }
    }
    renderToolbarActions('top_toolbar');
    handler.init();
}, false);

        </script>


</head><body>
    <!-- site header: icon, view, login/logout, language selection -->
    <table border='0' width='100%'>
        <tr>
            <!-- logo -->
            <td class='icon'><img id='icon_img' class='icon' src='images/kuntajana_a.png' width='100%'></td>
            <!-- login form -->
            <td>
                <div id='loginForm' class='loginForm' align='center'></div>
            </td>
            <td>
                <table border='0' width='100%'>
                    <tr>
                        <td align='center'>
                            <div id='top_toolbar' class='toolbar'></div>                                
                        </td>
                        <td align='right'>
                            <div class='localeSelector'>
                                <span ttbr='#{SwitchTo} #{Finnish}'><img id='locale_fi' class='localeSelector' src='images/icons8-fi-144.png' alt='#{Finnish}' onclick='doLanguageSet("fi");'><tt>#{SwitchTo} #{Finnish}</tt></span>
                                <span ttbr='#{SwitchTo} #{Russian}'><img id='locale_ru' class='localeSelector' src='images/icons8-ru-144.png' alt='#{Russian}' onclick='doLanguageSet("ru");'><tt>#{SwitchTo} #{Russian}</tt></span>
                                <span ttbr='#{SwitchTo} #{English}'><img id='locale_en' class='localeSelector' src='images/icons8-en-144.png' alt='#{English}' onclick='doLanguageSet("en");'><tt>#{SwitchTo} #{English}</tt></span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan='2' align='right'>
                            <div id='userInfo' class='userInfo'></div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <table border='0' width='100%'>
        <tr>
            <td width='0%' rowspan='2' valign='top'>
                <div id="v_filter"></div>
            </td>
            <td width='100%' valign='top'>
                <div id="h_filter"></div>
            </td>
        </tr>
        <tr>
            <td valign='top'>
                <div id="data_view"></div>            
            </td>
        </tr>
    </table>
    <div id="data_view2"></div>
    <br/>
    <div id='info_1'></div>
    <div id="pane_all" style="border: solid black 1px; padding: 0px;">
        <table width='100%' border='1'><tr>
                <td>A</td>
                <td>B</td>
                <td>C</td>
                <td>D</td>
                <td>E</td>
            </tr></table>
        <div>
            <a onclick='var el=document.getElementById("request_info"); if(el && el.style.display!="block") el.style.display="block"; else el.style.display="none";'>INFO ON/OFF</a>
            <div id='request_info' style='display: none;'>
            ${request}
            </div>
        </div>
    </div>
</body></html>